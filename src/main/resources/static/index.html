<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CRUD — Edwing Mejía</title>

<!-- BOOTSTRAP -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
  body {
    background: #f4f7fa;
  }
  h1 {
    text-align: center;
    margin-top: 20px;
    font-weight: 700;
    color: #0d6efd;
  }
  .card {
    border-radius: 10px;
  }
</style>
</head>

<body>

<h1 class="mt-3 mb-4 text-center">CRUD — Edwing Mejía</h1>

<div class="container mt-4">

  <!-- FORM -->
  <div class="card p-4 mb-4">
    <h5 class="mb-3">Registrar Datos</h5>
    <form id="wendyForm">
  <input type="hidden" id="id">

  <div class="row">
    <div class="col-md-6 mb-3">
      <label class="form-label">Nombre Completo</label>
      <input type="text" id="nombreCompleto" class="form-control" required>
    </div>

    <div class="col-md-3 mb-3">
      <label class="form-label">Tipo Documento</label>
      <input type="text" id="tipoDocumento" class="form-control" required>
    </div>

    <div class="col-md-3 mb-3">
      <label class="form-label">Documento</label>
      <input type="text" id="documento" class="form-control" required>
    </div>

    <div class="col-md-4 mb-3">
      <label class="form-label">Email</label>
      <input type="email" id="email" class="form-control" required>
    </div>

    <div class="col-md-4 mb-3">
      <label class="form-label">Teléfono</label>
      <input type="text" id="telefono" class="form-control" required>
    </div>

    <div class="col-md-4 mb-3">
      <label class="form-label">Dirección</label>
      <input type="text" id="direccion" class="form-control" required>
    </div>

    <div class="col-md-4 mb-3">
      <label class="form-label">Ciudad</label>
      <input type="text" id="ciudad" class="form-control">
    </div>

    <div class="col-md-4 mb-3">
      <label class="form-label">País</label>
      <input type="text" id="pais" class="form-control">
    </div>

    <div class="col-md-4 mb-3">
      <label class="form-label">Fecha de Nacimiento</label>
      <input type="date" id="fechaNacimiento" class="form-control">
    </div>

    <div class="col-12 mb-3">
      <label class="form-label">Descripción</label>
      <textarea id="descripcion" class="form-control" rows="2"></textarea>
    </div>
  </div>

  <button type="submit" class="btn btn-primary">Guardar</button>
  <button type="button" class="btn btn-secondary" onclick="cancelar()">Cancelar</button>
</form>
  </div>

  <!-- TABLE -->
  <div class="card p-3">
    <h5 class="mb-3">Listado</h5>
    <table class="table table-striped">
      <thead class="table-primary">
        <tr>
          <th>Nombre Completo</th>
          <th>Tipo Documento</th>
          <th>Documento</th>
          <th>Email</th>
          <th>Teléfono</th>
          <th>Dirección</th>
          <th>Ciudad</th>
          <th>País</th>
          <th>Fecha Nacimiento</th>
          <th>Descripción</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody id="wendyTable"></tbody>
    </table>
  </div>

</div>

<!-- BOOTSTRAP + JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const API_URL = "/api/edwing";

// Cargar datos al iniciar
document.addEventListener("DOMContentLoaded", cargarDatos);

function safe(value) {
  return (value === null || value === undefined) ? "" : value;
}

function cargarDatos(){
  fetch(API_URL)
    .then(res => res.json())
    .then(data => {
      let html = "";
      data.forEach(item => {
        html += `
          <tr>
            <td>${safe(item.nombreCompleto)}</td>
            <td>${safe(item.tipoDocumento)}</td>
            <td>${safe(item.documento)}</td>
            <td>${safe(item.email)}</td>
            <td>${safe(item.telefono)}</td>
            <td>${safe(item.direccion)}</td>
            <td>${safe(item.ciudad)}</td>
            <td>${safe(item.pais)}</td>
            <td>${safe(item.fechaNacimiento)}</td>
            <td>${safe(item.descripcion)}</td>
            <td>
              <button class="btn btn-warning btn-sm" onclick='editar(${JSON.stringify(item)})'>Editar</button>
              <button class="btn btn-danger btn-sm" onclick="eliminar(${item.id})">Eliminar</button>
            </td>
          </tr>
        `;
      });
      document.getElementById("wendyTable").innerHTML = html;
    });
}

// Crear o actualizar
document.getElementById("wendyForm").addEventListener("submit", e => {
  e.preventDefault();

  const id = document.getElementById("id").value;
  const data = {
    nombreCompleto: document.getElementById("nombreCompleto").value,
    tipoDocumento: document.getElementById("tipoDocumento").value,
    documento: document.getElementById("documento").value,
    email: document.getElementById("email").value,
    telefono: document.getElementById("telefono").value,
    direccion: document.getElementById("direccion").value,
    ciudad: document.getElementById("ciudad").value,
    pais: document.getElementById("pais").value,
    fechaNacimiento: document.getElementById("fechaNacimiento").value,
    descripcion: document.getElementById("descripcion").value
  };

  const method = id ? "PUT" : "POST";
  const url = id ? `${API_URL}/${id}` : API_URL;

  fetch(url, {
    method: method,
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(data)
  }).then(() => {
    cancelar();
    cargarDatos();
  });
});

function editar(item){
  document.getElementById("id").value = item.id;
  document.getElementById("nombreCompleto").value = item.nombreCompleto || "";
  document.getElementById("tipoDocumento").value = item.tipoDocumento || "";
  document.getElementById("documento").value = item.documento || "";
  document.getElementById("email").value = item.email || "";
  document.getElementById("telefono").value = item.telefono || "";
  document.getElementById("direccion").value = item.direccion || "";
  document.getElementById("ciudad").value = item.ciudad || "";
  document.getElementById("pais").value = item.pais || "";
  document.getElementById("fechaNacimiento").value = item.fechaNacimiento || "";
  document.getElementById("descripcion").value = item.descripcion || "";
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function eliminar(id){
  if(confirm("¿Seguro de eliminar?")){
    fetch(`${API_URL}/${id}`, { method:"DELETE" })
      .then(() => cargarDatos());
  }
}

function cancelar(){
  document.getElementById("wendyForm").reset();
  document.getElementById("id").value = "";
}
</script>

</body>
</html>
